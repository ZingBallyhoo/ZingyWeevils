@{
    <script src="https://unpkg.com/@@ruffle-rs/ruffle" async></script>
    <script type="text/javascript">
    window.RufflePlayer = window.RufflePlayer || {};
    window.RufflePlayer.config = {
        autoplay: "on",
        unmuteOverlay: "hidden", // dont bother to show, interaction is required anyway
        favorFlash: true, // allow real flash player if enabled
        upgradeToHttps: true,
        letterbox: "off", // no black bars in fullscreen
        maxExecutionDuration: 35, // we can stall pretty bad during weevilPet_assets load
        socketProxy: [
            {
                host: "127.0.0.1",
                port: 9339,
                proxyUrl: window.location.protocol === "https:" ? 
                    "wss://" + location.host + "/ws" :
                    "ws://" + location.host + "/ws"
            }
        ]
    }
    window.fetch = new Proxy(window.fetch, {
        apply: function (target, that, args) {
            // some assets just use hardcoded domains (e.g diner) -_-
            
            // console.log(args[0]);
            
            let request = args[0];
            // not always a request, but if not, there will be no url field and nothing will happen
            
            let requestUrl = request.url;
            if (requestUrl !== undefined) {
                let parsedUrl = new URL(requestUrl);
                
                if (parsedUrl.host === "play.binweevils.com") {
                    parsedUrl.host = window.location.host;
                    request = new Request(parsedUrl.toString(), request);
                }
            }

            args[0] = request;
            return target.apply(that, args);
        },
    });
    </script>
}    